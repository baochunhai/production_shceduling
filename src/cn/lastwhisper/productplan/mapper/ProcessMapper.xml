<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.lastwhisper.productplan.mapper.ProcessMapper">
  <resultMap id="BaseResultMap" type="cn.lastwhisper.productplan.pojo.Process">
    <id column="MPSNO" jdbcType="CHAR" property="mpsno" />
    <id column="PROCESSNO" jdbcType="CHAR" property="processno" />
    <result column="SEQUENCENO" jdbcType="CHAR" property="sequenceno" />
    <result column="MACHINENO" jdbcType="CHAR" property="machineno" />
    <result column="SCHEDULEDSTARTTIME" jdbcType="CHAR" property="scheduledstarttime" />
    <result column="SCHEDULEDENDTIME" jdbcType="CHAR" property="scheduledendtime" />
    <result column="ACTUALSTARTTIME" jdbcType="CHAR" property="actualstarttime" />
    <result column="ACTUALENDTIME" jdbcType="CHAR" property="actualendtime" />
    <result column="STATUS" jdbcType="CHAR" property="status" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="map">
    delete from WISDOM.PROCESS
    where MPSNO = #{mpsno,jdbcType=CHAR}
      and PROCESSNO = #{processno,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="cn.lastwhisper.productplan.pojo.Process">
    insert into WISDOM.PROCESS (MPSNO, PROCESSNO, SEQUENCENO, 
      MACHINENO, SCHEDULEDSTARTTIME, SCHEDULEDENDTIME, 
      ACTUALSTARTTIME, ACTUALENDTIME, STATUS
      )
    values (#{mpsno,jdbcType=CHAR}, #{processno,jdbcType=CHAR}, #{sequenceno,jdbcType=CHAR}, 
      #{machineno,jdbcType=CHAR}, #{scheduledstarttime,jdbcType=CHAR}, #{scheduledendtime,jdbcType=CHAR}, 
      #{actualstarttime,jdbcType=CHAR}, #{actualendtime,jdbcType=CHAR}, #{status,jdbcType=CHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.lastwhisper.productplan.pojo.Process">
    update WISDOM.PROCESS
    set SEQUENCENO = #{sequenceno,jdbcType=CHAR},
      MACHINENO = #{machineno,jdbcType=CHAR},
      SCHEDULEDSTARTTIME = #{scheduledstarttime,jdbcType=CHAR},
      SCHEDULEDENDTIME = #{scheduledendtime,jdbcType=CHAR},
      ACTUALSTARTTIME = #{actualstarttime,jdbcType=CHAR},
      ACTUALENDTIME = #{actualendtime,jdbcType=CHAR},
      STATUS = #{status,jdbcType=CHAR}
    where MPSNO = #{mpsno,jdbcType=CHAR}
      and PROCESSNO = #{processno,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
    select MPSNO, PROCESSNO, SEQUENCENO, MACHINENO, SCHEDULEDSTARTTIME, SCHEDULEDENDTIME, 
    ACTUALSTARTTIME, ACTUALENDTIME, STATUS
    from WISDOM.PROCESS
    where MPSNO = #{mpsno,jdbcType=CHAR}
      and PROCESSNO = #{processno,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select MPSNO, PROCESSNO, SEQUENCENO, MACHINENO, SCHEDULEDSTARTTIME, SCHEDULEDENDTIME, 
    ACTUALSTARTTIME, ACTUALENDTIME, STATUS
    from WISDOM.PROCESS
  </select>
   <select id="selectProcesslistByPage" parameterType="cn.lastwhisper.productplan.pojo.Mps" resultType="java.util.Map">
	select MPSNo,SequenceNo,Process.ProcessNo,ProcessName from Process,carbonknowledge  
	where 1=1
	<if test="mpsno!=null and mpsno!=''">
		   and rtrim(MPSNO) = #{mpsno}
	</if>
	and Process.ProcessNo=carbonknowledge.ProcessNo 
	order by cast(sequenceno as integer)
	</select>
	<select id="selectMps" resultType="java.util.Map">
    select MPSNO from MPS order by MPSNO
  </select>
  <!--显示工时预测相关内容  -->
  <select id="selectPredictlistByPage"
	parameterType="cn.lastwhisper.productplan.pojo.Mps"
	resultType="java.util.Map">
	select GA.mpsno, taskno, processfileno, p.processno, processname,
	wm_concat(m.machineno)
	machineno,wm_concat(round(ga.proctime/60,1)) proctime
	from GA,MPS,Process p,CarbonKnowledge c,Machine m
	where GA.MachineNo=m.ID and GA.mpsno=MPS.mpsno
	and GA.mpsno=p.mpsno and p.sequenceno=GA.processno
	and p.processno=c.processno and c.type=rtrim(mps.type)
	<if test="mpsno!=null and mpsno!=''">
		   and rtrim(ga.MPSNO) = #{mpsno}
	</if>
	group by ga.mpsno,taskno,processfileno, p.processno,processname
	</select>
	
	<!--显示制造资源配置相关内容  -->
  <select id="selectManuePlanelistByPage" parameterType="cn.lastwhisper.productplan.pojo.Mps" resultType="java.util.Map">
	select mps.mpsno,taskno,processfileno,p.processno,processname,
	wm_concat(c.machineno) machineno
	 from MPS,CarbonKnowledge ck,CarbonMachineWorker c,Process p
	  where mps.mpsno=p.mpsno and p.processno=c.processno 
	  and ck.processno=c.processno  and c.type=rtrim(mps.type) and c.type=ck.type
	 <if test="mpsno!=null and mpsno!=''">
		   and rtrim(mps.MPSNO) = #{mpsno}
	</if>
	   group by mps.mpsno,taskno,processfileno,p.processno,processname
	</select>
</mapper>